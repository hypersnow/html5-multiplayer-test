!function t(e,i,o){function s(n,r){if(!i[n]){if(!e[n]){var h="function"==typeof require&&require;if(!r&&h)return h(n,!0);if(a)return a(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[n]={exports:{}};e[n][0].call(d.exports,function(t){var i=e[n][1][t];return s(i?i:t)},d,d.exports,t,e,i,o)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<o.length;n++)s(o[n]);return s}({1:[function(t,e,i){function o(){game=new Phaser.Game(800,600,Phaser.AUTO,""),socket=io(),game.state.add("boot",t("./states/boot.js")),game.state.add("preload",t("./states/preload.js")),game.state.add("game",t("./states/game.js")),game.state.start("boot")}window.game=null,window.socket=null,window.loaded=!1,o()},{"./states/boot.js":4,"./states/game.js":5,"./states/preload.js":6}],2:[function(t,e,i){var o=function(t,e,i,o){switch(Phaser.Sprite.call(this,game,t,e,"bullet",0),game.physics.arcade.enable(this),this.control=o,this.anchor.setTo(.5,.5),this.speed=1e3,i){case"left":this.body.velocity.x=-this.speed,this.angle=180;break;case"right":this.body.velocity.x=this.speed;break;case"up":this.body.velocity.y=-this.speed,this.angle=270;break;case"down":this.body.velocity.y=this.speed,this.angle=90}this.dead=!1,setInterval(this.die.bind(this),300),game.add.existing(this)};o.prototype=Object.create(Phaser.Sprite.prototype),o.prototype.constructor=o,o.prototype.moveUpdate=function(t,e){return this.bringToTop(),this.control&&game.physics.arcade.overlap(this,t,this.hitOtherPlayer,null,this),this.game.physics.arcade.overlap(this,e)||this.dead},o.prototype.die=function(){this.dead=!0},o.prototype.hitOtherPlayer=function(t,e){e.body.velocity.x+=t.body.velocity.x,e.body.velocity.y+=t.body.velocity.y,this.dead=!0},e.exports=o},{}],3:[function(t,e,i){var o=t("./bullet"),s=function(t,e,i){Phaser.Sprite.call(this,game,e,i,"player",0),game.physics.arcade.enable(this),this.control=t,t&&(this.body.gravity.y=3500),this.updatedX=e,this.updatedY=i,this.animations.add("run",[1,2],10,!0),this.anchor.setTo(.5,1),this.scale.x=2,this.scale.y=2,this.body.setSize(10,30,0,0),this.tint="0x"+Math.round(Math.random()*Math.pow(2,24)).toString(16),this.nickname="Player "+String(game.rnd.integerInRange(1e3,9999)),this.nicknameText=game.add.text(e+32,i-16,this.nickname,{fontSize:"16px",fill:"#000"}),this.jumping=!1,this.jump=600,this.jumpPrevious=0,this.jumpAmount=0,this.jumpLimit=8,this.moveTimer=0,this.canShoot=!0,this.shootPower=400,this.shootInterval=setInterval(this.reshoot.bind(this),120),this.bullets=game.add.group(),this.bullets.classType=o,this.bullets.enableBody=!0,game.add.existing(this)};s.prototype=Object.create(Phaser.Sprite.prototype),s.prototype.constructor=s,s.prototype.moveUpdate=function(t,e,i){game.physics.arcade.collide(this,e),this.control?(game.input.keyboard.isDown(Phaser.Keyboard.A)&&(this.body.velocity.x-=50),game.input.keyboard.isDown(Phaser.Keyboard.D)&&(this.body.velocity.x+=50),game.input.keyboard.isDown(Phaser.Keyboard.A)||game.input.keyboard.isDown(Phaser.Keyboard.D)||i.left.isDown||i.right.isDown||(this.body.velocity.x>0?this.body.velocity.x-=50:this.body.velocity.x<0&&(this.body.velocity.x+=50),Math.abs(this.body.velocity.x)<=100&&(this.body.velocity.x=0)),this.body.velocity.x>800?this.body.velocity.x=800:this.body.velocity.x<-800&&(this.body.velocity.x=-800),this.body.velocity.x>400?this.body.velocity.x-=100:this.body.velocity.x<-400&&(this.body.velocity.x+=100),!this.jumping&&game.input.keyboard.isDown(Phaser.Keyboard.W)&&this.body.touching.down&&(this.jumping=!0,this.jumpAmount=0),this.jumping&&(this.body.velocity.y=-this.jump,game.input.keyboard.isDown(Phaser.Keyboard.W)&&this.jumpAmount<=this.jumpLimit?this.jumpAmount++:this.jumping=!1),this.jumpPrevious=this.y,this.canShoot&&(this.addBullet(!0,this.x,this.y-32,i.left.isDown,i.right.isDown,i.up.isDown,i.down.isDown,this.shootPower),(i.left.isDown||i.right.isDown||i.up.isDown||i.down.isDown)&&(socket.emit("bullet",[this.x,this.y-32,i.left.isDown,i.right.isDown,i.up.isDown,i.down.isDown]),this.canShoot=!1)),0==this.body.velocity.y||this.body.touching.down?0!=this.body.velocity.x?this.animations.play("run"):(this.animations.stop(),this.frame=0):(this.animations.stop(),this.frame=3),0==this.body.velocity.x&&0==this.body.velocity.y?this.moveTimer>0&&this.moveTimer--:this.moveTimer=120,game.physics.arcade.overlap(this,this.bullets,this.hitBullet,null,this)):(game.physics.arcade.distanceToXY(this,this.updatedX,this.updatedY)>64&&(this.x=this.updatedX,this.y=this.updatedY),game.physics.arcade.moveToXY(this,this.updatedX,this.updatedY,300,60)),0!=this.body.velocity.x&&(this.body.velocity.x>0?this.scale.x=2:this.scale.x=-2);var o=12,s=64;this.x<-o?this.x=game.world.width+o:this.x>game.world.width+o&&(this.x=-o),this.y<-s?this.y=game.world.height+s:this.y>game.world.height+s&&(this.y=-s),this.bringToTop(),this.nicknameText.bringToTop(),this.nicknameText.text=this.nickname,this.nicknameText.x=this.x-46,this.nicknameText.y=this.y-84,this.bullets.forEach(function(i){i.moveUpdate(t,e)&&this.bullets.remove(i,!0)},this)},s.prototype.destroy=function(){this.nicknameText.destroy(),Phaser.Sprite.prototype.destroy.call(this)},s.prototype.reshoot=function(){this.canShoot=!0},s.prototype.addBullet=function(t,e,i,s,a,n,r,h){s&&(t&&(this.body.velocity.x+=h),this.bullets.add(new o(e,i,"left",t))),a&&(t&&(this.body.velocity.x-=h),this.bullets.add(new o(e,i,"right",t))),n&&(t&&(this.body.velocity.y+=h),this.bullets.add(new o(e,i,"up",t))),r&&(t&&(this.body.velocity.y-=h),this.bullets.add(new o(e,i,"down",t)))},s.prototype.hitBullet=function(t,e){e.control||(this.body.velocity.x+=e.body.velocity.x,this.body.velocity.y+=e.body.velocity.y,e.destroy())},e.exports=s},{"./bullet":2}],4:[function(t,e,i){var o=function(){};e.exports=o,o.prototype={create:function(){game.scale.scaleMode=Phaser.ScaleManager.RESIZE,game.physics.startSystem(Phaser.Physics.ARCADE),game.world.setBounds(0,0,2e3,2e3),game.stage.smoothed=!1,game.state.start("preload")}}},{}],5:[function(t,e,i){var o=t("../entities/player"),s=function(){};e.exports=s,s.prototype={sendIntervalTime:60,fixedSendIntervalTime:600,initSend:!1,buddydistancetimer:0,create:function(){this.onSocketConnect(),this.setEventHandlers();var t=game.add.sprite(0,0,"sky");t.width=game.world.width,t.height=game.world.height,this.player=new o(!0,30,30),this.player.name=socket.id,game.camera.follow(this.player,Phaser.Camera.FOLLOW_PLATFORMER),this.initSend=!0,this.otherPlayers=game.add.group(),this.otherPlayers.classType=o,this.otherPlayers.enableBody=!0,this.platforms=game.add.group(),this.platforms.enableBody=!0,this.addPlatform(0,game.world.height-64,2,2),this.addPlatform(400,400,200,2),this.addPlatform(0,250,1,1),this.addPlatform(600,300,1,1),this.addPlatform(800,1500,1,1),this.addPlatform(1200,900,1,1),this.stars=game.add.group(),this.stars.enableBody=!0;for(var e=0;12>e;e++){var i=this.stars.create(70*e,0,"star");i.body.gravity.y=600,i.body.bounce.y=.7+.2*Math.random()}this.cursors=game.input.keyboard.createCursorKeys(),this.score=0,this.scoreText=game.add.text(16,16,"Coins: 0",{fontSize:"32px",fill:"#000"}),this.scoreText.fixedToCamera=!0},addPlatform:function(t,e,i,o){var s=this.platforms.create(t,e,"ground");s.scale.setTo(i,o),s.body.immovable=!0,s.body.checkCollision.left=!1,s.body.checkCollision.right=!1,s.body.checkCollision.down=!1},setEventHandlers:function(){socket.on("connect",this.onSocketConnect.bind(this)),socket.on("disconnect",this.onSocketDisconnect.bind(this)),socket.on("player connect",this.onPlayerConnect.bind(this)),socket.on("player update",this.onPlayerUpdate.bind(this)),socket.on("player disconnect",this.onPlayerDisconnect.bind(this)),socket.on("players",this.onPlayers.bind(this)),socket.on("player count",this.onPlayers.bind(this)),socket.on("bullet",this.onBullet.bind(this))},update:function(){this.player.moveUpdate(this.otherPlayers,this.platforms,this.cursors),this.game.physics.arcade.collide(this.stars,this.platforms),this.game.physics.arcade.overlap(this.player,this.stars,this.collectStar,null,this),this.otherPlayers.forEach(function(t){t.moveUpdate(this.otherPlayers,this.platforms,this.cursors)},this)},collectStar:function(t,e){e.kill(),this.score+=10,this.scoreText.text="Coins: "+this.score},onSocketConnect:function(){console.log("connected to server"),this.sendInterval=setInterval(this.sendLoop.bind(this),this.sendIntervalTime),this.sendInterval=setInterval(this.fixedSendLoop.bind(this),this.fixedSendIntervalTime)},onSocketDisconnect:function(){console.log("disconnected from server"),clearInterval(this.sendInterval),game.state.start("preload")},onPlayerConnect:function(t){this.addOtherPlayer(t),console.log("new player connected with id "+t[1])},onPlayerUpdate:function(t){for(var e in t)this.otherPlayers.forEach(function(i){t[e][0]==i.name&&(i.updatedX=t[e][1],i.updatedY=t[e][2],i.frame=t[e][3],i.body.velocity.x=t[e][4],i.body.velocity.y=t[e][5])},this)},onPlayerDisconnect:function(t){this.otherPlayers.forEach(function(e){t=="/#"+e.name&&(e.destroy(),console.log("player dced"))},this)},onPlayers:function(t){this.otherPlayers.removeAll(!0);for(var e in t)t[e][1]!=this.player.name&&this.addOtherPlayer(t[e])},onBullet:function(t){this.player.addBullet(!1,t[0],t[1],t[2],t[3],t[4],t[5],this.player.shootPower)},fixedSendLoop:function(){this.sendPlayerUpdate(),socket.emit("player count",this.otherPlayers.length+1)},sendLoop:function(){this.initSend?(socket.emit("player init",[!0,this.player.name,this.player.x,this.player.y,this.player.frame,this.player.nickname,this.player.tint,this.player.body.velocity.x,this.player.body.velocity.y]),this.initSend=!1):(0!=this.player.body.velocity.x||0!=this.player.body.velocity.y||this.player.moveTimer>0)&&this.sendPlayerUpdate()},sendPlayerUpdate:function(){socket.emit("player update",[!0,this.player.x,this.player.y,this.player.frame,this.player.body.velocity.x,this.player.body.velocity.y])},addOtherPlayer:function(t){var e=this.otherPlayers.add(new o(!1,t[2],t[3]));e.name=t[1],e.frame=t[4],e.nickname=t[5],e.tint=t[6],e.body.velocity.x=t[7],e.body.velocity.y=t[8]}}},{"../entities/player":3}],6:[function(t,e,i){(function(t){var i=function(){};e.exports=i,i.prototype={preload:function(){if(loaded)this.connect();else{var t=game.add.text(16,16,"Loading...",{fontSize:"24px",fill:"#FFFFFF"}),e=this;game.load.image("sky","../assets/sky.png"),game.load.image("ground","../assets/platform.png"),game.load.image("star","../assets/star.png"),game.load.image("bullet","../assets/bullet.png"),game.load.image("pixel","../assets/pixel.png"),game.load.spritesheet("player","../assets/player.png",32,32),game.load.spritesheet("hit","../assets/hit.png",32,32),game.load.onLoadComplete.add(function(){loaded=!0,t.destroy(),e.connect()})}},connect:function(){var e=game.add.text(16,16,"Connecting...",{fontSize:"24px",fill:"#FFFFFF"});socket=io.connect(t.env.PORT),socket.on("connect",function(){e.destroy(),game.state.start("game")})}}}).call(this,t("_process"))},{_process:7}],7:[function(t,e,i){function o(){d=!1,r.length?l=r.concat(l):c=-1,l.length&&s()}function s(){if(!d){var t=setTimeout(o);d=!0;for(var e=l.length;e;){for(r=l,l=[];++c<e;)r&&r[c].run();c=-1,e=l.length}r=null,d=!1,clearTimeout(t)}}function a(t,e){this.fun=t,this.array=e}function n(){}var r,h=e.exports={},l=[],d=!1,c=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new a(t,e)),1!==l.length||d||setTimeout(s,0)},a.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=n,h.addListener=n,h.once=n,h.off=n,h.removeListener=n,h.removeAllListeners=n,h.emit=n,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}]},{},[1]);
//# sourceMappingURL=html5-multiplayer-test.min.js.map
