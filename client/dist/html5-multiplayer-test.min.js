!function t(e,i,o){function s(a,h){if(!i[a]){if(!e[a]){var r="function"==typeof require&&require;if(!h&&r)return r(a,!0);if(n)return n(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){var i=e[a][1][t];return s(i?i:t)},c,c.exports,t,e,i,o)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<o.length;a++)s(o[a]);return s}({1:[function(t,e,i){function o(){game=new Phaser.Game(800,600,Phaser.AUTO,""),socket=io(),game.state.add("boot",t("./states/boot.js")),game.state.add("preload",t("./states/preload.js")),game.state.add("game",t("./states/game.js")),game.state.start("boot")}window.game=null,window.socket=null,window.loaded=!1,o()},{"./states/boot.js":4,"./states/game.js":5,"./states/preload.js":6}],2:[function(t,e,i){var o=function(t,e,i,o){switch(Phaser.Sprite.call(this,game,t,e,"bullet",0),game.physics.arcade.enable(this),this.control=o,this.anchor.setTo(.5,.5),this.speed=1e3,i){case"left":this.body.velocity.x=-this.speed,this.angle=180;break;case"right":this.body.velocity.x=this.speed;break;case"up":this.body.velocity.y=-this.speed,this.angle=270;break;case"down":this.body.velocity.y=this.speed,this.angle=90}this.dead=!1,this.dieInterval=setInterval(this.die.bind(this),300),this.addHitEffect(this.x,this.y),game.add.existing(this)};o.prototype=Object.create(Phaser.Sprite.prototype),o.prototype.constructor=o,o.prototype.moveUpdate=function(t,e){return this.bringToTop(),this.control&&game.physics.arcade.overlap(this,t,this.hitOtherPlayer,null,this),this.game.physics.arcade.overlap(this,e)&&this.die(),this.dead},o.prototype.die=function(){this.dead=!0,this.addHitEffect(this.x,this.y),clearInterval(this.dieInterval)},o.prototype.hitOtherPlayer=function(t,e){e.body.velocity.x+=t.body.velocity.x,e.body.velocity.y+=t.body.velocity.y,this.dead=!0},o.prototype.addHitEffect=function(t,e){var i=game.add.sprite(t,e,"hit");i.anchor.setTo(.5,.5),i.animations.add("anim"),i.play("anim",60,!1,!0)},e.exports=o},{}],3:[function(t,e,i){var o=t("./bullet"),s=function(t,e,i){Phaser.Sprite.call(this,game,e,i,"player",0),game.physics.arcade.enable(this),this.control=t,t&&(this.body.gravity.y=3500),this.updatedX=e,this.updatedY=i,this.animations.add("run",[1,2],10,!0),this.anchor.setTo(.5,1),this.scale.x=2,this.scale.y=2,this.body.setSize(10,30,0,0),this.tint="0x"+Math.round(Math.random()*Math.pow(2,24)).toString(16),this.nickname="Player "+String(game.rnd.integerInRange(1e3,9999)),this.nicknameText=game.add.text(e+32,i-16,this.nickname,{fontSize:"16px",fill:"#000"}),this.coinCount=10,this.coinText=game.add.text(e+32,i-32,this.coinCount+"c",{fontSize:"16px",fill:"#000"}),this.jumping=!1,this.jump=600,this.jumpPrevious=0,this.jumpAmount=0,this.jumpLimit=8,this.moveTimer=0,this.canShoot=!0,this.shootPower=400,this.shootInterval=setInterval(this.reshoot.bind(this),120),this.bullets=game.add.group(),this.bullets.classType=o,this.bullets.enableBody=!0,this.g=null,game.add.existing(this)};s.prototype=Object.create(Phaser.Sprite.prototype),s.prototype.constructor=s,s.prototype.moveUpdate=function(t,e,i,o){this.g=t,game.physics.arcade.collide(this,i),this.control?(game.input.keyboard.isDown(Phaser.Keyboard.A)&&(this.body.velocity.x-=50),game.input.keyboard.isDown(Phaser.Keyboard.D)&&(this.body.velocity.x+=50),game.input.keyboard.isDown(Phaser.Keyboard.A)||game.input.keyboard.isDown(Phaser.Keyboard.D)||o.left.isDown||o.right.isDown||(this.body.velocity.x>0?this.body.velocity.x-=50:this.body.velocity.x<0&&(this.body.velocity.x+=50),Math.abs(this.body.velocity.x)<=100&&(this.body.velocity.x=0)),this.body.velocity.x>800?this.body.velocity.x=800:this.body.velocity.x<-800&&(this.body.velocity.x=-800),this.body.velocity.x>400?this.body.velocity.x-=100:this.body.velocity.x<-400&&(this.body.velocity.x+=100),!this.jumping&&game.input.keyboard.isDown(Phaser.Keyboard.W)&&this.body.touching.down&&(this.jumping=!0,this.jumpAmount=0),this.jumping&&(this.body.velocity.y=-this.jump,game.input.keyboard.isDown(Phaser.Keyboard.W)&&this.jumpAmount<=this.jumpLimit?this.jumpAmount++:this.jumping=!1),this.jumpPrevious=this.y,this.canShoot&&(this.addBullet(!0,this.x,this.y-32,o.left.isDown,o.right.isDown,o.up.isDown,o.down.isDown,this.shootPower),(o.left.isDown||o.right.isDown||o.up.isDown||o.down.isDown)&&(socket.emit("bullet",[this.x,this.y-32,o.left.isDown,o.right.isDown,o.up.isDown,o.down.isDown]),this.canShoot=!1)),0==this.body.velocity.y||this.body.touching.down?0!=this.body.velocity.x?this.animations.play("run"):(this.animations.stop(),this.frame=0):(this.animations.stop(),this.frame=3),0==this.body.velocity.x&&0==this.body.velocity.y?this.moveTimer>0&&this.moveTimer--:this.moveTimer=120,this.coinCount=t.coinCount,game.physics.arcade.overlap(this,this.bullets,this.hitBullet,null,this)):(game.physics.arcade.distanceToXY(this,this.updatedX,this.updatedY)>64&&(this.x=this.updatedX,this.y=this.updatedY),game.physics.arcade.moveToXY(this,this.updatedX,this.updatedY,300,60)),0!=this.body.velocity.x&&(this.body.velocity.x>0?this.scale.x=2:this.scale.x=-2);var s=6,n=64;this.x<-s?this.x=game.world.width+s:this.x>game.world.width+s&&(this.x=-s),this.y<-n?this.y=game.world.height+n:this.y>game.world.height+n&&(this.y=-n),this.bringToTop(),this.nicknameText.bringToTop(),this.nicknameText.text=this.nickname,this.nicknameText.x=this.x-46,this.nicknameText.y=this.y-84,this.coinText.bringToTop(),this.coinText.text=this.coinCount+"c",this.coinText.x=this.x-46,this.coinText.y=this.y-100,this.bullets.forEach(function(t){t.moveUpdate(e,i)&&this.bullets.remove(t,!0)},this)},s.prototype.destroy=function(){this.nicknameText.destroy(),Phaser.Sprite.prototype.destroy.call(this)},s.prototype.reshoot=function(){this.canShoot=!0},s.prototype.addBullet=function(t,e,i,s,n,a,h,r){s&&(t&&(this.body.velocity.x+=r),this.bullets.add(new o(e,i,"left",t))),n&&(t&&(this.body.velocity.x-=r),this.bullets.add(new o(e,i,"right",t))),a&&(t&&(this.body.velocity.y+=r),this.bullets.add(new o(e,i,"up",t))),h&&(t&&(this.body.velocity.y-=r),this.bullets.add(new o(e,i,"down",t)))},s.prototype.hitBullet=function(t,e){e.control||(this.body.velocity.x+=e.body.velocity.x,this.body.velocity.y+=e.body.velocity.y,e.destroy(),this.g.coinCount>0&&(socket.emit("player hit",[this.x,this.y-16]),this.g.coinCount--,this.g.coinText.text="Coins: "+this.g.coinCount))},e.exports=s},{"./bullet":2}],4:[function(t,e,i){var o=function(){};e.exports=o,o.prototype={create:function(){game.scale.scaleMode=Phaser.ScaleManager.RESIZE,game.physics.startSystem(Phaser.Physics.ARCADE),game.world.setBounds(0,0,2e3,2e3),game.stage.disableVisibilityChange=!0,game.stage.smoothed=!1,game.state.start("preload")}}},{}],5:[function(t,e,i){var o=t("../entities/player"),s=function(){};e.exports=s,s.prototype={sendIntervalTime:60,fixedSendIntervalTime:600,initSend:!1,buddydistancetimer:0,create:function(){this.onSocketConnect(),this.setEventHandlers();var t=game.add.sprite(0,0,"sky");t.width=game.world.width,t.height=game.world.height,this.player=new o(!0,30,30),this.player.name=socket.id,game.camera.follow(this.player,Phaser.Camera.FOLLOW_PLATFORMER),this.initSend=!0,this.otherPlayers=game.add.group(),this.otherPlayers.classType=o,this.otherPlayers.enableBody=!0,this.platforms=game.add.group(),this.platforms.enableBody=!0,this.addPlatform(0,game.world.height-64,2,2),this.addPlatform(400,400,200,2),this.addPlatform(0,250,1,1),this.addPlatform(600,300,1,1),this.addPlatform(800,1500,1,1),this.addPlatform(1200,900,1,1),this.coins=game.add.group(),this.coins.enableBody=!0,this.cursors=game.input.keyboard.createCursorKeys(),this.coinCount=10,this.coinText=game.add.text(16,16,"Coins: "+this.coinCount,{fontSize:"32px",fill:"#000"}),this.coinText.fixedToCamera=!0},addPlatform:function(t,e,i,o){var s=this.platforms.create(t,e,"ground");s.scale.setTo(i,o),s.body.immovable=!0,s.body.checkCollision.left=!1,s.body.checkCollision.right=!1,s.body.checkCollision.down=!1},setEventHandlers:function(){socket.on("connect",this.onSocketConnect.bind(this)),socket.on("disconnect",this.onSocketDisconnect.bind(this)),socket.on("player connect",this.onPlayerConnect.bind(this)),socket.on("player update",this.onPlayerUpdate.bind(this)),socket.on("player disconnect",this.onPlayerDisconnect.bind(this)),socket.on("players",this.onPlayers.bind(this)),socket.on("player count",this.onPlayers.bind(this)),socket.on("bullet",this.onBullet.bind(this)),socket.on("coin",this.onCoin.bind(this)),socket.on("destroy coin",this.onDestroyCoin.bind(this)),socket.on("got coin",this.onGotCoin.bind(this))},update:function(){this.player.moveUpdate(this,this.otherPlayers,this.platforms,this.cursors),this.game.physics.arcade.collide(this.coins,this.platforms),this.game.physics.arcade.overlap(this.player,this.coins,this.collectCoin,null,this),this.otherPlayers.forEach(function(t){t.moveUpdate(this,this.otherPlayers,this.platforms,this.cursors)},this),this.coins.forEach(function(t){var e=6,i=64;t.x<-e?t.x=game.world.width+e:t.x>game.world.width+e&&(t.x=-e),t.y<-i?t.y=game.world.height+i:t.y>game.world.height+i&&(t.y=-i),t.body.velocity.x>0?t.body.velocity.x-=2:t.body.velocity.x<0&&(t.body.velocity.x+=2)},this)},collectCoin:function(t,e){socket.emit("got coin",e.name)},onSocketConnect:function(){console.log("connected to server"),this.sendInterval=setInterval(this.sendLoop.bind(this),this.sendIntervalTime),this.sendInterval=setInterval(this.fixedSendLoop.bind(this),this.fixedSendIntervalTime)},onSocketDisconnect:function(){console.log("disconnected from server"),clearInterval(this.sendInterval),game.state.start("preload")},onPlayerConnect:function(t){this.addOtherPlayer(t),console.log("new player connected with id "+t[1])},onPlayerUpdate:function(t){for(var e in t)this.otherPlayers.forEach(function(i){t[e][0]==i.name?(i.updatedX=t[e][1],i.updatedY=t[e][2],i.frame=t[e][3],i.body.velocity.x=t[e][4],i.body.velocity.y=t[e][5],i.coinCount=t[e][6]):t[e][0]==this.player.name&&(this.player.coinCount=t[e][6])},this)},onPlayerDisconnect:function(t){this.otherPlayers.forEach(function(e){t=="/#"+e.name&&(this.otherPlayers.remove(e),e.destroy(),console.log("player dced"))},this)},onPlayers:function(t){this.otherPlayers.removeAll(!0);for(var e in t)t[e][1]!=this.player.name&&this.addOtherPlayer(t[e])},onBullet:function(t){this.player.addBullet(!1,t[0],t[1],t[2],t[3],t[4],t[5],this.player.shootPower)},onCoin:function(t){this.addCoin(t[0],t[1],t[2],t[3],t[4])},onDestroyCoin:function(t){this.coins.forEach(function(e){e.name==t&&(this.coins.remove(e),e.destroy(),this.addHitEffect(e.x,e.y))},this)},onGotCoin:function(t){this.coinCount++,this.coinText.text="Coins: "+this.coinCount,this.sendPlayerUpdate()},fixedSendLoop:function(){this.sendPlayerUpdate(),socket.emit("player count",this.otherPlayers.length+1)},sendLoop:function(){this.initSend?(socket.emit("player init",[!0,this.player.name,this.player.x,this.player.y,this.player.frame,this.player.nickname,this.player.tint,this.player.body.velocity.x,this.player.body.velocity.y,this.coinCount]),this.initSend=!1):(0!=this.player.body.velocity.x||0!=this.player.body.velocity.y||this.player.moveTimer>0)&&this.sendPlayerUpdate()},sendPlayerUpdate:function(){socket.emit("player update",[!0,this.player.x,this.player.y,this.player.frame,this.player.body.velocity.x,this.player.body.velocity.y,this.coinCount])},addOtherPlayer:function(t){var e=this.otherPlayers.add(new o(!1,t[2],t[3]));e.name=t[1],e.frame=t[4],e.nickname=t[5],e.tint=t[6],e.body.velocity.x=t[7],e.body.velocity.y=t[8]},addHitEffect:function(t,e){var i=game.add.sprite(t,e,"hit");i.anchor.setTo(.5,.5),i.animations.add("anim"),i.play("anim",60,!1,!0)},addCoin:function(t,e,i,o,s){var n=this.coins.create(t,e,"coin");n.name=s,n.anchor.setTo(.5,.5),n.animations.add("spin"),n.animations.play("spin",40,!0),n.body.gravity.y=1e3,n.body.bounce.y=.7,n.body.velocity.x=i,n.body.velocity.y=o}}},{"../entities/player":3}],6:[function(t,e,i){(function(t){var i=function(){};e.exports=i,i.prototype={preload:function(){if(loaded)this.connect();else{var t=game.add.text(16,16,"Loading...",{fontSize:"24px",fill:"#FFFFFF"}),e=this;game.load.image("sky","../assets/sky.png"),game.load.image("ground","../assets/platform.png"),game.load.image("bullet","../assets/bullet.png"),game.load.image("pixel","../assets/pixel.png"),game.load.spritesheet("player","../assets/player.png",32,32),game.load.spritesheet("coin","../assets/coin.png",32,32),game.load.spritesheet("hit","../assets/hit.png",32,32),game.load.onLoadComplete.add(function(){loaded=!0,t.destroy(),e.connect()})}},connect:function(){var e=game.add.text(16,16,"Connecting...",{fontSize:"24px",fill:"#FFFFFF"});socket=io.connect(t.env.PORT),socket.on("connect",function(){e.destroy(),game.state.start("game")})}}}).call(this,t("_process"))},{_process:7}],7:[function(t,e,i){function o(){c=!1,h.length?d=h.concat(d):l=-1,d.length&&s()}function s(){if(!c){var t=setTimeout(o);c=!0;for(var e=d.length;e;){for(h=d,d=[];++l<e;)h&&h[l].run();l=-1,e=d.length}h=null,c=!1,clearTimeout(t)}}function n(t,e){this.fun=t,this.array=e}function a(){}var h,r=e.exports={},d=[],c=!1,l=-1;r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];d.push(new n(t,e)),1!==d.length||c||setTimeout(s,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=a,r.addListener=a,r.once=a,r.off=a,r.removeListener=a,r.removeAllListeners=a,r.emit=a,r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}]},{},[1]);
//# sourceMappingURL=html5-multiplayer-test.min.js.map
