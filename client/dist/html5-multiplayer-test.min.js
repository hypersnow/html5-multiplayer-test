!function t(e,i,o){function s(a,r){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!r&&h)return h(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[a]={exports:{}};e[a][0].call(l.exports,function(t){var i=e[a][1][t];return s(i?i:t)},l,l.exports,t,e,i,o)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<o.length;a++)s(o[a]);return s}({1:[function(t,e,i){function o(){game=new Phaser.Game(800,600,Phaser.AUTO,""),socket=io(),game.state.add("boot",t("./states/boot.js")),game.state.add("preload",t("./states/preload.js")),game.state.add("game",t("./states/game.js")),game.state.start("boot")}window.game=null,window.socket=null,window.loaded=!1,o()},{"./states/boot.js":3,"./states/game.js":4,"./states/preload.js":5}],2:[function(t,e,i){var o=function(t,e,i){Phaser.Sprite.call(this,game,t,e,"player",0),game.physics.arcade.enable(this),this.control=i,this.body.gravity.y=3500,this.animations.add("run",[1,2],10,!0),this.anchor.setTo(.5,1),this.scale.x=2,this.scale.y=2,this.body.setSize(10,30,0,0),this.tint="0x"+Math.round(Math.random()*Math.pow(2,24)).toString(16),this.nickname="Player "+String(game.rnd.integerInRange(1e3,9999)),this.nicknameText=game.add.text(t+32,e-16,this.nickname,{fontSize:"16px",fill:"#000"}),this.jumping=!1,this.jump=600,this.jumpPrevious=0,this.jumpAmount=0,this.jumpLimit=8,game.add.existing(this)};o.prototype=Object.create(Phaser.Sprite.prototype),o.prototype.constructor=o,o.prototype.moveUpdate=function(t,e){game.physics.arcade.collide(this,t),this.control&&(this.body.velocity.x=0,game.input.keyboard.isDown(Phaser.Keyboard.A)?this.body.velocity.x=-400:game.input.keyboard.isDown(Phaser.Keyboard.D)&&(this.body.velocity.x=400),!this.jumping&&game.input.keyboard.isDown(Phaser.Keyboard.W)&&this.body.touching.down&&(this.jumping=!0,this.jumpAmount=0),this.jumping&&(this.body.velocity.y=-this.jump,game.input.keyboard.isDown(Phaser.Keyboard.W)&&this.jumpAmount<=this.jumpLimit?this.jumpAmount++:this.jumping=!1),this.jumpPrevious=this.y),0==this.body.velocity.y||this.body.touching.down?0!=this.body.velocity.x?(this.animations.play("run"),this.body.velocity.x>0?this.scale.x=2:this.scale.x=-2):(this.animations.stop(),this.frame=0):(this.animations.stop(),this.frame=3);var i=12,o=64;this.x<-i?this.x=game.world.width+i:this.x>game.world.width+i&&(this.x=-i),this.y<-o?this.y=game.world.height+o:this.y>game.world.height+o&&(this.y=-o),this.bringToTop(),this.nicknameText.bringToTop(),this.nicknameText.text=this.nickname,this.nicknameText.x=this.x-46,this.nicknameText.y=this.y-84},o.prototype.destroy=function(){this.nicknameText.destroy(),Phaser.Sprite.prototype.destroy.call(this)},e.exports=o},{}],3:[function(t,e,i){var o=function(){};e.exports=o,o.prototype={create:function(){game.scale.scaleMode=Phaser.ScaleManager.RESIZE,game.physics.startSystem(Phaser.Physics.ARCADE),game.world.setBounds(0,0,2e3,2e3),game.stage.smoothed=!1,game.state.start("preload")}}},{}],4:[function(t,e,i){var o=t("../entities/player"),s=function(){};e.exports=s,s.prototype={sendIntervalTime:60,fixedSendIntervalTime:600,initSend:!1,buddydistancetimer:0,create:function(){this.onSocketConnect(),this.setEventHandlers();var t=game.add.sprite(0,0,"sky");t.width=game.world.width,t.height=game.world.height,this.player=new o(30,30,!0),this.player.name=socket.id,game.camera.follow(this.player,Phaser.Camera.FOLLOW_PLATFORMER),this.initSend=!0,this.otherPlayers=game.add.group(),this.otherPlayers.classType=o,this.otherPlayers.enableBody=!0,this.platforms=game.add.group(),this.platforms.enableBody=!0,this.addPlatform(0,game.world.height-64,2,2),this.addPlatform(400,400,200,2),this.addPlatform(0,250,1,1),this.addPlatform(600,300,1,1),this.stars=game.add.group(),this.stars.enableBody=!0;for(var e=0;12>e;e++){var i=this.stars.create(70*e,0,"star");i.body.gravity.y=600,i.body.bounce.y=.7+.2*Math.random()}this.cursors=game.input.keyboard.createCursorKeys(),this.score=0,this.scoreText=game.add.text(16,16,"Coins: 0",{fontSize:"32px",fill:"#000"}),this.scoreText.fixedToCamera=!0},addPlatform:function(t,e,i,o){var s=this.platforms.create(t,e,"ground");s.scale.setTo(i,o),s.body.immovable=!0,s.body.checkCollision.left=!1,s.body.checkCollision.right=!1,s.body.checkCollision.down=!1},setEventHandlers:function(){socket.on("connect",this.onSocketConnect.bind(this)),socket.on("disconnect",this.onSocketDisconnect.bind(this)),socket.on("player connect",this.onPlayerConnect.bind(this)),socket.on("player update",this.onPlayerUpdate.bind(this)),socket.on("player disconnect",this.onPlayerDisconnect.bind(this)),socket.on("players",this.onPlayers.bind(this)),socket.on("player count",this.onPlayers.bind(this))},update:function(){this.player.moveUpdate(this.platforms,this.cursors),this.game.physics.arcade.collide(this.stars,this.platforms),this.game.physics.arcade.overlap(this.player,this.stars,this.collectStar,null,this),this.otherPlayers.forEach(function(t){t.moveUpdate(this.platforms,this.cursors)},this)},collectStar:function(t,e){e.kill(),this.score+=10,this.scoreText.text="Coins: "+this.score},onSocketConnect:function(){console.log("connected to server"),this.sendInterval=setInterval(this.sendLoop.bind(this),this.sendIntervalTime),this.sendInterval=setInterval(this.fixedSendLoop.bind(this),this.fixedSendIntervalTime)},onSocketDisconnect:function(){console.log("disconnected from server"),clearInterval(this.sendInterval),game.state.start("preload")},onPlayerConnect:function(t){this.addOtherPlayer(t),console.log("new player connected with id "+t[1])},onPlayerUpdate:function(t){for(var e in t)this.otherPlayers.forEach(function(i){t[e][0]==i.name&&(i.x=t[e][1],i.y=t[e][2],i.frame=t[e][3],i.body.velocity.x=t[e][4],i.body.velocity.y=t[e][5])},this)},onPlayerDisconnect:function(t){this.otherPlayers.forEach(function(e){t=="/#"+e.name&&(e.destroy(),console.log("player dced"))},this)},onPlayers:function(t){this.otherPlayers.removeAll(!0);for(var e in t)t[e][1]!=this.player.name&&this.addOtherPlayer(t[e])},fixedSendLoop:function(){this.sendPlayerUpdate(),socket.emit("player count",this.otherPlayers.length+1)},sendLoop:function(){this.initSend?(socket.emit("player init",[!0,this.player.name,this.player.x,this.player.y,this.player.frame,this.player.nickname,this.player.tint,this.player.body.velocity.x,this.player.body.velocity.y]),this.initSend=!1):0==this.player.body.velocity.x&&0==this.player.body.velocity.y||this.sendPlayerUpdate()},sendPlayerUpdate:function(){socket.emit("player update",[!0,this.player.x,this.player.y,this.player.frame,this.player.body.velocity.x,this.player.body.velocity.y])},addOtherPlayer:function(t){var e=this.otherPlayers.add(new o(t[2],t[3],!1));e.name=t[1],e.frame=t[4],e.nickname=t[5],e.tint=t[6],e.body.velocity.x=t[7],e.body.velocity.y=t[8]}}},{"../entities/player":2}],5:[function(t,e,i){(function(t){var i=function(){};e.exports=i,i.prototype={preload:function(){if(loaded)this.connect();else{var t=game.add.text(16,16,"Loading...",{fontSize:"24px",fill:"#FFFFFF"}),e=this;game.load.image("sky","../assets/sky.png"),game.load.image("ground","../assets/platform.png"),game.load.image("star","../assets/star.png"),game.load.image("pixel","../assets/pixel.png"),game.load.spritesheet("player","../assets/player.png",32,32),game.load.onLoadComplete.add(function(){loaded=!0,t.destroy(),e.connect()})}},connect:function(){var e=game.add.text(16,16,"Connecting...",{fontSize:"24px",fill:"#FFFFFF"});socket=io.connect(t.env.PORT),socket.on("connect",function(){e.destroy(),game.state.start("game")})}}}).call(this,t("_process"))},{_process:6}],6:[function(t,e,i){function o(){l=!1,r.length?c=r.concat(c):d=-1,c.length&&s()}function s(){if(!l){var t=setTimeout(o);l=!0;for(var e=c.length;e;){for(r=c,c=[];++d<e;)r&&r[d].run();d=-1,e=c.length}r=null,l=!1,clearTimeout(t)}}function n(t,e){this.fun=t,this.array=e}function a(){}var r,h=e.exports={},c=[],l=!1,d=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new n(t,e)),1!==c.length||l||setTimeout(s,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}]},{},[1]);
//# sourceMappingURL=html5-multiplayer-test.min.js.map
